#!/bin/bash

set -euo pipefail

# command for new pane is commented
# in main.go on last line

main_go_last_line=$(
    tail -n1 main.go
)

modeline="// cmd: "

if ! [[ $main_go_last_line =~ $modeline ]]; then
    echo "error: no command provide in main.go"
    exit 1
fi

cmd=$(
    echo $main_go_last_line | sed "s|$modeline||"
)

tmux kill-pane -t 1 >/dev/null 2>&1 || true

tmux split-window -h -c `pwd` -p 50 "$cmd; sleep 5m"

tmux last-pane
